var Radar=function(){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f="radar-description",n="radar-deviceId",v="radar-host",S="radar-placesProvider",a="radar-publishableKey",x="radar-userId";function _(e){if(!document||void 0===document.cookie)return null;var t="".concat(e,"="),n=document.cookie.split(";").find(function(e){return-1!=e.indexOf(t)});return n?n.trim().substring(t.length):null}function i(e,t){if(document&&void 0!==!document.cookie&&"string"==typeof t){var n=new Date;n.setFullYear(n.getFullYear()+10);var o="expires=".concat(n.toGMTString());document.cookie="".concat(e,"=").concat(t,";path=/;").concat(o)}}function R(e){document&&document.cookie&&(document.cookie="".concat(e,"=;expires=Thu, 01-Jan-1970 00:00:01 GMT;path=/"))}function g(){var e=_(n);if(e)return e;var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)});return i(n,t),t}var p={ERROR_LOCATION:"ERROR_LOCATION",ERROR_NETWORK:"ERROR_NETWORK",ERROR_PERMISSIONS:"ERROR_PERMISSIONS",ERROR_PUBLISHABLE_KEY:"ERROR_PUBLISHABLE_KEY",ERROR_RATE_LIMIT:"ERROR_RATE_LIMIT",ERROR_SERVER:"ERROR_SERVER",ERROR_UNAUTHORIZED:"ERROR_UNAUTHORIZED",SUCCESS:"SUCCESS"};var c={FACEBOOK:"facebook",NONE:"none"},I="1.1.0";return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"initialize",value:function(e){e||console.error('Radar "initialize" was called without a publishable key'),i(a,e)}},{key:"setHost",value:function(e){i(v,e)}},{key:"setPlacesProvider",value:function(e){e!==c.FACEBOOK&&(e=c.NONE),i(S,e)}},{key:"setUserId",value:function(e){e?0===(e=String(e).trim()).length||256<e.length?R(x):i(x,e):R(x)}},{key:"setDescription",value:function(e){e?0===(e=String(e).trim()).length||256<e.length?R(f):i(f,e):R(f)}},{key:"trackOnce",value:function(d){var l=_(a);l?navigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){if(t&&t.coords){var e=t.coords,n=e.accuracy,o=e.latitude,r=e.longitude,a=g(),i=_(x),R=_(S),c=_(f),u=i||a,s={Authorization:l},E={accuracy:n,description:c,deviceId:a,deviceType:"Web",foreground:!0,latitude:o,longitude:r,placesProvider:R,sdkVersion:I,stopped:!0,userAgent:navigator.userAgent,userId:i},O=_(v)||"https://api.radar.io";!function(e,t,n,o,r,a){var i=new XMLHttpRequest;for(var R in i.open(e,t,!0),i.setRequestHeader("Content-Type","application/json"),o)i.setRequestHeader(R,o[R]);i.onload=function(){200==i.status?r(i.response):401==i.status?a(p.ERROR_UNAUTHORIZED):429==i.status?a(p.ERROR_RATE_LIMIT):a(p.ERROR_SERVER)},i.onerror=function(){a(p.ERROR_SERVER)},i.timeout=function(){a(p.ERROR_NETWORK)},i.send(JSON.stringify(n))}("PUT","".concat(O,"/v1/users/").concat(u),E,s,function(e){try{e=JSON.parse(e),d&&d(p.SUCCESS,t.coords,e.user,e.events)}catch(e){d&&d(p.ERROR_SERVER)}},function(e){d&&d(e)})}else d&&d(p.ERROR_LOCATION)},function(e){d&&e&&e.code&&(1===e.code?d(p.ERROR_PERMISSIONS):d(p.ERROR_LOCATION))}):d&&d(p.ERROR_LOCATION):d&&d(p.ERROR_PUBLISHABLE_KEY)}},{key:"VERSION",get:function(){return I}},{key:"PLACES_PROVIDER",get:function(){return c}},{key:"STATUS",get:function(){return p}}],(n=null)&&r(t.prototype,n),o&&r(t,o),e}()}();
